<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Apocalypse - Point & Click Survival</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            overflow: hidden;
            cursor: crosshair;
        }

        #gameContainer {
            display: flex;
            height: 100vh;
        }

        #mapContainer {
            flex: 1;
            position: relative;
        }

        #map {
            height: 100vh;
            filter: grayscale(80%) sepia(20%) hue-rotate(60deg) brightness(0.8);
            cursor: crosshair;
        }

        .moving-cursor {
            cursor: wait !important;
        }

        .leaflet-container {
            cursor: crosshair !important;
        }

        .leaflet-clickable {
            cursor: pointer !important;
        }

        #sidebar {
            width: 320px;
            background: #0d1117;
            border-left: 2px solid #00ff00;
            padding: 20px;
            overflow-y: auto;
        }

        .stats-panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .stat-bar {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            align-items: center;
        }

        .bar {
            width: 150px;
            height: 12px;
            background: #30363d;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #21262d;
        }

        .bar-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .health { background: linear-gradient(90deg, #ff4444, #ff6666); }
        .stamina { background: linear-gradient(90deg, #44ff44, #66ff66); }
        .hunger { background: linear-gradient(90deg, #ffaa44, #ffcc66); }

        .inventory {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .inventory h3 {
            color: #00ff00;
            margin-bottom: 10px;
            text-align: center;
        }

        .item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #30363d;
            cursor: pointer;
            transition: background 0.2s;
        }

        .item:hover {
            background: #21262d;
        }

        .action-panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .action-button {
            background: #238636;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin: 5px 0;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
        }

        .action-button:hover:not(:disabled) {
            background: #2ea043;
            transform: translateY(-1px);
        }

        .action-button:disabled {
            background: #656d76;
            cursor: not-allowed;
            transform: none;
        }

        .building-panel {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            display: none;
        }

        .building-panel.active {
            display: block;
        }

        .building-info {
            background: #1f2328;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
        }

        .location-info {
            background: #1f2328;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            margin: 10px 0;
            font-size: 13px;
        }

        .danger-level {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .danger-low { background: #238636; color: white; }
        .danger-medium { background: #fb8500; color: white; }
        .danger-high { background: #da3633; color: white; }

        .game-log {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 12px;
            height: 180px;
            overflow-y: auto;
            font-size: 12px;
        }

        .log-entry {
            margin: 3px 0;
            padding: 3px;
            border-left: 3px solid transparent;
            padding-left: 8px;
        }

        .log-success { 
            color: #3fb950; 
            border-left-color: #3fb950;
            background: rgba(63, 185, 80, 0.1);
        }
        .log-warning { 
            color: #d29922; 
            border-left-color: #d29922;
            background: rgba(210, 153, 34, 0.1);
        }
        .log-danger { 
            color: #f85149; 
            border-left-color: #f85149;
            background: rgba(248, 81, 73, 0.1);
        }
        .log-info {
            color: #58a6ff;
            border-left-color: #58a6ff;
            background: rgba(88, 166, 255, 0.1);
        }

        .movement-indicator {
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 0, 0.6);
            border: 2px solid #ffff00;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            animation: pulse-move 1s ease-out;
        }

        @keyframes pulse-move {
            0% { 
                transform: scale(0.5);
                opacity: 1;
            }
            100% { 
                transform: scale(1.5);
                opacity: 0;
            }
        }

        .zombie-marker {
            width: 20px;
            height: 20px;
            background: #ff0000;
            border: 2px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            animation: zombie-pulse 2s infinite;
            cursor: pointer;
        }

        @keyframes zombie-pulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 5px #ff0000;
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 15px #ff0000;
            }
        }

        .controls-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(13, 17, 23, 0.95);
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #30363d;
            font-size: 12px;
            max-width: 300px;
        }

        .distance-indicator {
            font-size: 11px;
            color: #7d8590;
            font-style: italic;
        }

        .cooldown-timer {
            position: absolute;
            top: 2px;
            right: 2px;
            background: #da3633;
            color: white;
            border-radius: 3px;
            padding: 1px 4px;
            font-size: 10px;
        }

        .building-highlight {
            background: rgba(0, 255, 0, 0.3) !important;
            border: 2px solid #00ff00 !important;
        }

        .map-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #238636;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            z-index: 1000;
        }

        .map-toggle:hover {
            background: #2ea043;
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .game-over-content {
            background: #161b22;
            border: 2px solid #da3633;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            color: #ff0000;
        }

        .restart-btn {
            background: #238636;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="mapContainer">
            <div id="map"></div>
            <div class="controls-info">
                <div><strong>ğŸ§Ÿ ZOMBIE APOCALYPSE</strong></div>
                <div>ğŸ“ Click anywhere to move</div>
                <div>ğŸ¢ Click buildings to interact</div>
                <div>ğŸ§Ÿ Avoid red zombie markers</div>
                <div>âš¡ Watch your stamina!</div>
            </div>
            <button class="map-toggle" onclick="toggleMapView()">ğŸ—ºï¸ Toggle Map</button>
        </div>
        
        <div id="sidebar">
            <div class="stats-panel">
                <h3>ğŸ® SURVIVOR STATUS</h3>
                <div class="stat-bar">
                    <span>â¤ï¸ Health:</span>
                    <div class="bar">
                        <div class="bar-fill health" id="healthBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-bar">
                    <span>âš¡ Stamina:</span>
                    <div class="bar">
                        <div class="bar-fill stamina" id="staminaBar" style="width: 100%"></div>
                    </div>
                </div>
                <div class="stat-bar">
                    <span>ğŸ– Hunger:</span>
                    <div class="bar">
                        <div class="bar-fill hunger" id="hungerBar" style="width: 100%"></div>
                    </div>
                </div>
            </div>

            <div class="location-info">
                <div><strong>ğŸ“ Current Location:</strong></div>
                <div id="currentLocation">New York City</div>
                <div style="margin-top: 8px;">
                    <strong>âš ï¸ Threat Level:</strong>
                    <span id="dangerLevel" class="danger-level danger-low">LOW</span>
                </div>
                <div class="distance-indicator" id="distanceInfo">Click to move around</div>
            </div>

            <div class="action-panel">
                <h3>ğŸ¯ QUICK ACTIONS</h3>
                <button class="action-button" onclick="useItem('ğŸ– Food')" id="eatBtn">
                    ğŸ– Eat Food
                </button>
                <button class="action-button" onclick="useItem('ğŸ’§ Water')" id="drinkBtn">
                    ğŸ’§ Drink Water
                </button>
                <button class="action-button" onclick="useItem('ğŸ©¹ Bandages')" id="healBtn">
                    ğŸ©¹ Use Bandage
                </button>
                <button class="action-button" onclick="rest()" id="restBtn">
                    ğŸ˜´ Rest (Recover Stamina)
                </button>
            </div>

            <div class="inventory">
                <h3>ğŸ’ INVENTORY</h3>
                <div id="inventoryList">
                    <div class="item">
                        <span>ğŸ’ Backpack</span>
                        <span>1</span>
                    </div>
                    <div class="item">
                        <span>ğŸ”ª Knife</span>
                        <span>1</span>
                    </div>
                </div>
            </div>

            <div class="building-panel" id="buildingPanel">
                <h3>ğŸ¢ BUILDING INTERACTION</h3>
                <div class="building-info">
                    <div><strong id="buildingName">Unknown Building</strong></div>
                    <div id="buildingDetails" style="margin-top: 5px;"></div>
                </div>
                <button class="action-button" id="searchBtn" onclick="searchBuilding()">
                    ğŸ” Search Building
                </button>
                <button class="action-button" onclick="closeBuildingPanel()" style="background: #656d76;">
                    ğŸšª Leave Building
                </button>
            </div>

            <div class="game-log">
                <div><strong>ğŸ“œ SURVIVAL LOG</strong></div>
                <div id="logEntries">
                    <div class="log-entry log-info">Game started. Click to move and survive!</div>
                    <div class="log-entry log-warning">The apocalypse has begun...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="game-over" id="gameOverScreen">
        <div class="game-over-content">
            <h2>ğŸ’€ GAME OVER ğŸ’€</h2>
            <p id="gameOverMessage">You didn't survive the apocalypse...</p>
            <button class="restart-btn" onclick="restartGame()">ğŸ”„ Try Again</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Game state
        let gameState = {
            player: {
                lat: 40.7128,
                lng: -74.0060,
                health: 100,
                stamina: 100,
                hunger: 100,
                isMoving: false
            },
            inventory: {
                'ğŸ’ Backpack': 1,
                'ğŸ”ª Knife': 1,
                'ğŸ©¹ Bandages': 3,
                'ğŸ’§ Water': 5,
                'ğŸ– Food': 8
            },
            lootedBuildings: new Set(),
            zombies: [],
            gameTime: 0,
            actionCooldowns: {},
            currentBuilding: null,
            survivalTime: 0
        };

        // Initialize map
        const map = L.map('map', {
            zoomControl: true,
            attributionControl: false
        }).setView([gameState.player.lat, gameState.player.lng], 17);

        // Tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        // Player marker
        const playerIcon = L.divIcon({
            className: 'player-icon',
            html: '<div style="width: 25px; height: 25px; background: #00ff00; border: 3px solid #fff; border-radius: 50%; box-shadow: 0 0 15px #00ff00; display: flex; align-items: center; justify-content: center; font-size: 14px;">ğŸ‘¤</div>',
            iconSize: [25, 25],
            iconAnchor: [12, 12]
        });

        let playerMarker = L.marker([gameState.player.lat, gameState.player.lng], {
            icon: playerIcon,
            zIndexOffset: 1000
        }).addTo(map);

        // Building types and loot tables
        const buildingTypes = {
            'hospital': {
                name: 'ğŸ¥ Hospital',
                loot: { 'ğŸ’Š Medical Kit': [2, 4], 'ğŸ©¹ Bandages': [3, 6], 'ğŸ’‰ Morphine': [1, 2] },
                danger: 'high',
                description: 'Medical supplies but crawling with infected'
            },
            'supermarket': {
                name: 'ğŸ›’ Supermarket',
                loot: { 'ğŸ– Food': [4, 10], 'ğŸ’§ Water': [3, 8], 'ğŸ”‹ Batteries': [2, 4] },
                danger: 'medium',
                description: 'Good supplies, moderate zombie presence'
            },
            'pharmacy': {
                name: 'ğŸ’Š Pharmacy',
                loot: { 'ğŸ’Š Medicine': [2, 5], 'ğŸ©¹ Bandages': [2, 4], 'ğŸ§´ Vitamins': [1, 3] },
                danger: 'medium',
                description: 'Medical supplies with some risk'
            },
            'restaurant': {
                name: 'ğŸ½ï¸ Restaurant',
                loot: { 'ğŸ– Food': [3, 7], 'ğŸ’§ Water': [2, 4], 'ğŸ”ª Kitchen Knife': [0, 1] },
                danger: 'low',
                description: 'Food supplies, relatively safe'
            },
            'school': {
                name: 'ğŸ« School',
                loot: { 'ğŸ“š Books': [1, 3], 'ğŸ”§ Tools': [1, 2], 'ğŸ Food': [2, 4] },
                danger: 'low',
                description: 'Basic supplies, low threat'
            },
            'bank': {
                name: 'ğŸ¦ Bank',
                loot: { 'ğŸ’° Cash': [100, 500], 'ğŸ—ï¸ Safe Keys': [0, 1], 'ğŸ’³ Cards': [1, 3] },
                danger: 'high',
                description: 'Valuable items but heavily defended'
            },
            'house': {
                name: 'ğŸ  House',
                loot: { 'ğŸ– Food': [2, 5], 'ğŸ’§ Water': [1, 3], 'ğŸ‘• Clothes': [1, 2], 'ğŸ”§ Tools': [0, 2] },
                danger: 'low',
                description: 'Family home with basic supplies'
            },
            'apartment': {
                name: 'ğŸ¢ Apartment',
                loot: { 'ğŸ– Food': [3, 7], 'ğŸ’§ Water': [2, 5], 'ğŸ‘• Clothes': [2, 4], 'ğŸ“± Electronics': [1, 2] },
                danger: 'medium',
                description: 'Multiple units to search'
            },
            'default': {
                name: 'ğŸ¢ Building',
                loot: { 'ğŸ—‘ï¸ Scrap': [1, 4], 'ğŸ”§ Basic Tools': [0, 2] },
                danger: 'low',
                description: 'Unknown building type'
            }
        };

        // Spawn zombies around the map
        function spawnZombies() {
            const center = map.getCenter();
            const bounds = map.getBounds();
            
            for (let i = 0; i < 20; i++) {
                const lat = bounds.getSouth() + Math.random() * (bounds.getNorth() - bounds.getSouth());
                const lng = bounds.getWest() + Math.random() * (bounds.getEast() - bounds.getWest());
                
                const zombieIcon = L.divIcon({
                    className: 'zombie-icon',
                    html: '<div class="zombie-marker">ğŸ§Ÿ</div>',
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });

                const zombie = L.marker([lat, lng], { 
                    icon: zombieIcon,
                    zIndexOffset: 500
                }).addTo(map);
                
                // Add click handler for zombies
                zombie.on('click', function(e) {
                    e.originalEvent.stopPropagation();
                    encounterZombie();
                });
                
                gameState.zombies.push(zombie);
            }
        }

        // Handle map clicks for movement and building interaction
        map.on('click', async function(e) {
            const { lat, lng } = e.latlng;
            
            // Check if clicking near a zombie
            for (let zombie of gameState.zombies) {
                const zombiePos = zombie.getLatLng();
                const distance = map.distance([lat, lng], [zombiePos.lat, zombiePos.lng]);
                if (distance < 50) {
                    encounterZombie();
                    return;
                }
            }

            // Show movement indicator
            showMovementIndicator(e.containerPoint);
            
            // Try to query for buildings first
            const query = `
                [out:json][timeout:15];
                (
                  way["building"](around:30,${lat},${lng});
                  relation["building"](around:30,${lat},${lng});
                );
                out geom;
            `;

            let foundBuilding = false;
            
            try {
                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    body: query
                });
                const data = await response.json();

                if (data.elements && data.elements.length > 0) {
                    const building = data.elements[0];
                    foundBuilding = true;
                    
                    // Move to building first
                    await movePlayerTo(lat, lng);
                    
                    // Then interact with building
                    interactWithBuilding(building, lat, lng);
                    return;
                }
            } catch (error) {
                console.error('Building query failed:', error);
            }

            // If no building found, just move
            if (!foundBuilding) {
                movePlayerTo(lat, lng);
            }
        });

        function showMovementIndicator(point) {
            const indicator = document.createElement('div');
            indicator.className = 'movement-indicator';
            indicator.style.left = (point.x - 15) + 'px';
            indicator.style.top = (point.y - 15) + 'px';
            document.getElementById('mapContainer').appendChild(indicator);
            
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.parentNode.removeChild(indicator);
                }
            }, 1000);
        }

        async function movePlayerTo(lat, lng) {
            if (gameState.player.isMoving) return;
            
            const distance = map.distance([gameState.player.lat, gameState.player.lng], [lat, lng]);
            const staminaCost = Math.min(Math.floor(distance / 20), 25);
            
            if (gameState.player.stamina < staminaCost) {
                addLogEntry('Not enough stamina to move that far!', 'warning');
                return false;
            }
            
            gameState.player.isMoving = true;
            document.body.classList.add('moving-cursor');
            
            // Update player position
            gameState.player.lat = lat;
            gameState.player.lng = lng;
            playerMarker.setLatLng([lat, lng]);
            
            // Consume stamina
            gameState.player.stamina = Math.max(0, gameState.player.stamina - staminaCost);
            updateUI();
            
            addLogEntry(`Moved ${Math.round(distance)}m (Cost: ${staminaCost} stamina)`, 'info');
            
            // Simulate movement time
            setTimeout(() => {
                gameState.player.isMoving = false;
                document.body.classList.remove('moving-cursor');
                
                // Random zombie encounter chance
                if (Math.random() < 0.1) {
                    encounterZombie();
                }
            }, 1000);
            
            return true;
        }

        function interactWithBuilding(building, lat, lng) {
            const buildingId = building.id || `${lat}_${lng}`;
            
            // Determine building type
            let buildingType = 'default';
            const tags = building.tags || {};
            
            if (tags.amenity === 'hospital') buildingType = 'hospital';
            else if (tags.amenity === 'pharmacy') buildingType = 'pharmacy';
            else if (tags.amenity === 'restaurant') buildingType = 'restaurant';
            else if (tags.amenity === 'school') buildingType = 'school';
            else if (tags.amenity === 'bank') buildingType = 'bank';
            else if (tags.shop === 'supermarket') buildingType = 'supermarket';
            else if (tags.building === 'house') buildingType = 'house';
            else if (tags.building === 'apartments') buildingType = 'apartment';
            
            const buildingInfo = buildingTypes[buildingType];
            gameState.currentBuilding = { id: buildingId, type: buildingType, info: buildingInfo };
            
            // Update UI
            document.getElementById('buildingName').textContent = buildingInfo.name;
            document.getElementById('buildingDetails').textContent = buildingInfo.description;
            document.getElementById('buildingPanel').classList.add('active');
            
            // Update danger level
            updateDangerLevel(buildingInfo.danger);
            
            addLogEntry(`Entered ${buildingInfo.name}`, 'info');
        }

        function searchBuilding() {
            if (!gameState.currentBuilding) return;
            
            const buildingId = gameState.currentBuilding.id;
            const buildingInfo = gameState.currentBuilding.info;
            
            if (gameState.lootedBuildings.has(buildingId)) {
                addLogEntry('This building has already been searched.', 'warning');
                return;
            }
            
            // Check if action is on cooldown
            if (gameState.actionCooldowns.search && Date.now() < gameState.actionCooldowns.search) {
                const remainingTime = Math.ceil((gameState.actionCooldowns.search - Date.now()) / 1000);
                addLogEntry(`Must wait ${remainingTime}s before searching again.`, 'warning');
                return;
            }
            
            // Set cooldown
            gameState.actionCooldowns.search = Date.now() + 5000;
            
            // Danger check based on building type
            let encounterChance = 0.1;
            if (buildingInfo.danger === 'medium') encounterChance = 0.3;
            if (buildingInfo.danger === 'high') encounterChance = 0.5;
            
            if (Math.random() < encounterChance) {
                encounterZombie();
                return;
            }
            
            // Generate loot
            const loot = {};
            for (const [item, range] of Object.entries(buildingInfo.loot)) {
                const amount = Math.floor(Math.random() * (range[1] - range[0] + 1)) + range[0];
                if (amount > 0) {
                    loot[item] = amount;
                }
            }
            
            // Add loot to inventory
            let foundItems = [];
            for (const [item, amount] of Object.entries(loot)) {
                if (gameState.inventory[item]) {
                    gameState.inventory[item] += amount;
                } else {
                    gameState.inventory[item] = amount;
                }
                foundItems.push(`${item} x${amount}`);
            }
            
            gameState.lootedBuildings.add(buildingId);
            
            if (foundItems.length > 0) {
                addLogEntry(`Found: ${foundItems.join(', ')}`, 'success');
            } else {
                addLogEntry('The building was empty...', 'warning');
            }
            
            updateUI();
        }

        function closeBuildingPanel() {
            document.getElementById('buildingPanel').classList.remove('active');
            gameState.currentBuilding = null;
            updateDangerLevel('low');
            addLogEntry('Left the building', 'info');
        }

        function encounterZombie() {
            const weapons = ['ğŸ”ª Knife', 'ğŸ—¡ï¸ Sword', 'ğŸ”¨ Hammer', 'âš”ï¸ Weapon'];
            let hasWeapon = false;
            
            for (const weapon of weapons) {
                if (gameState.inventory[weapon] && gameState.inventory[weapon] > 0) {
                    hasWeapon = true;
                    break;
                }
            }
            
            const damage = hasWeapon ? Math.floor(Math.random() * 20) + 10 : Math.floor(Math.random() * 40) + 20;
            gameState.player.health = Math.max(0, gameState.player.health - damage);
            
            const message = hasWeapon ? 
                `Fought off a zombie with your weapon! Lost ${damage} health.` :
                `Zombie attack! No weapon to defend. Lost ${damage} health.`;
            
            addLogEntry(message, 'danger');
            updateUI();
            
            if (gameState.player.health <= 0) {
                gameOver('Killed by zombies');
            }
        }

        function useItem(item) {
            if (!gameState.inventory[item] || gameState.inventory[item] <= 0) {
                addLogEntry(`No ${item} available!`, 'warning');
                return;
            }
            
            gameState.inventory[item]--;
            
            switch(item) {
                case 'ğŸ– Food':
                    gameState.player.hunger = Math.min(100, gameState.player.hunger + 30);
                    addLogEntry('Ate food. Hunger reduced.', 'success');
                    break;
                case 'ğŸ’§ Water':
                    gameState.player.hunger = Math.min(100, gameState.player.hunger + 20);
                    addLogEntry('Drank water. Thirst quenched.', 'success');
                    break;
                case 'ğŸ©¹ Bandages':
                    gameState.player.health = Math.min(100, gameState.player.health + 25);
                    addLogEntry('Used bandage. Health restored.', 'success');
                    break;
            }
            
            updateUI();
        }

        function rest() {
            if (gameState.actionCooldowns.rest && Date.now() < gameState.actionCooldowns.rest) {
                const remainingTime = Math.ceil((gameState.actionCooldowns.rest - Date.now()) / 1000);
                addLogEntry(`Must wait ${remainingTime}s before resting again.`, 'warning');
                return;
            }
            
            gameState.actionCooldowns.rest = Date.now() + 10000;
            gameState.player.stamina = Math.min(100, gameState.player.stamina + 40);
            addLogEntry('Rested and recovered stamina.', 'success');
            updateUI();
            
            // Small chance of zombie encounter while resting
            if (Math.random() < 0.2) {
                setTimeout(() => encounterZombie(), 2000);
            }
        }

        function updateUI() {
            // Update health bar
            document.getElementById('healthBar').style.width = gameState.player.health + '%';
            
            // Update stamina bar
            document.getElementById('staminaBar').style.width = gameState.player.stamina + '%';
            
            // Update hunger bar
            document.getElementById('hungerBar').style.width = gameState.player.hunger + '%';
            
            // Update inventory
            const inventoryList = document.getElementById('inventoryList');
            inventoryList.innerHTML = '';
            
            for (const [item, count] of Object.entries(gameState.inventory)) {
                if (count > 0) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item';
                    itemDiv.innerHTML = `<span>${item}</span><span>${count}</span>`;
                    inventoryList.appendChild(itemDiv);
                }
            }
            
            // Update action buttons
            document.getElementById('eatBtn').disabled = !gameState.inventory['ğŸ– Food'] || gameState.inventory['ğŸ– Food'] <= 0;
            document.getElementById('drinkBtn').disabled = !gameState.inventory['ğŸ’§ Water'] || gameState.inventory['ğŸ’§ Water'] <= 0;
            document.getElementById('healBtn').disabled = !gameState.inventory['ğŸ©¹ Bandages'] || gameState.inventory['ğŸ©¹ Bandages'] <= 0;
            
            // Update rest button cooldown
            if (gameState.actionCooldowns.rest && Date.now() < gameState.actionCooldowns.rest) {
                const remainingTime = Math.ceil((gameState.actionCooldowns.rest - Date.now()) / 1000);
                document.getElementById('restBtn').innerHTML = `ğŸ˜´ Rest (${remainingTime}s)`;
                document.getElementById('restBtn').disabled = true;
            } else {
                document.getElementById('restBtn').innerHTML = 'ğŸ˜´ Rest (Recover Stamina)';
                document.getElementById('restBtn').disabled = false;
            }
            
            // Update search button cooldown
            if (gameState.actionCooldowns.search && Date.now() < gameState.actionCooldowns.search) {
                const remainingTime = Math.ceil((gameState.actionCooldowns.search - Date.now()) / 1000);
                document.getElementById('searchBtn').innerHTML = `ğŸ” Search (${remainingTime}s)`;
                document.getElementById('searchBtn').disabled = true;
            } else {
                document.getElementById('searchBtn').innerHTML = 'ğŸ” Search Building';
                document.getElementById('searchBtn').disabled = false;
            }
        }

        function updateDangerLevel(level) {
            const dangerElement = document.getElementById('dangerLevel');
            dangerElement.className = `danger-level danger-${level}`;
            dangerElement.textContent = level.toUpperCase();
        }

        function addLogEntry(message, type = 'info') {
            const logEntries = document.getElementById('logEntries');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logEntries.appendChild(entry);
            logEntries.scrollTop = logEntries.scrollHeight;
            
            // Keep only last 50 entries
            while (logEntries.children.length > 50) {
                logEntries.removeChild(logEntries.firstChild);
            }
        }

        function gameOver(reason) {
            document.getElementById('gameOverMessage').textContent = reason;
            document.getElementById('gameOverScreen').style.display = 'flex';
            addLogEntry(`Game Over: ${reason}`, 'danger');
        }

        function restartGame() {
            // Reset game state
            gameState = {
                player: {
                    lat: 40.7128,
                    lng: -74.0060,
                    health: 100,
                    stamina: 100,
                    hunger: 100,
                    isMoving: false
                },
                inventory: {
                    'ğŸ’ Backpack': 1,
                    'ğŸ”ª Knife': 1,
                    'ğŸ©¹ Bandages': 3,
                    'ğŸ’§ Water': 5,
                    'ğŸ– Food': 8
                },
                lootedBuildings: new Set(),
                zombies: [],
                gameTime: 0,
                actionCooldowns: {},
                currentBuilding: null,
                survivalTime: 0
            };
            
            // Clear zombies
            gameState.zombies.forEach(zombie => map.removeLayer(zombie));
            gameState.zombies = [];
            
            // Reset player position
            playerMarker.setLatLng([gameState.player.lat, gameState.player.lng]);
            map.setView([gameState.player.lat, gameState.player.lng], 17);
            
            // Hide game over screen
            document.getElementById('gameOverScreen').style.display = 'none';
            
            // Close building panel
            closeBuildingPanel();
            
            // Respawn zombies
            spawnZombies();
            
            // Update UI
            updateUI();
            
            addLogEntry('Game restarted. Good luck survivor!', 'info');
        }

        function toggleMapView() {
            const currentZoom = map.getZoom();
            if (currentZoom > 15) {
                map.setZoom(13);
            } else {
                map.setZoom(17);
            }
        }

        // Game loop for hunger/stamina degradation
        function gameLoop() {
            gameState.gameTime++;
            gameState.survivalTime++;
            
            // Gradual hunger increase
            if (gameState.gameTime % 30 === 0) {
                gameState.player.hunger = Math.max(0, gameState.player.hunger - 1);
                if (gameState.player.hunger <= 0) {
                    gameState.player.health = Math.max(0, gameState.player.health - 5);
                    if (gameState.player.health <= 0) {
                        gameOver('Died of starvation');
                        return;
                    }
                }
            }
            
            // Gradual stamina recovery when not moving
            if (!gameState.player.isMoving && gameState.gameTime % 10 === 0) {
                gameState.player.stamina = Math.min(100, gameState.player.stamina + 1);
            }
            
            updateUI();
        }

        // Initialize game
        function initGame() {
            spawnZombies();
            updateUI();
            addLogEntry('Welcome to the zombie apocalypse!', 'info');
            addLogEntry('Click on the map to move around and find buildings to search.', 'info');
            
            // Start game loop
            setInterval(gameLoop, 1000);
            
            // Update cooldown timers
            setInterval(updateUI, 1000);
        }

        // Start the game when page loads
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
